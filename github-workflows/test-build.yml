name: Test Build

on:
  workflow_dispatch:
  push:
    branches: [ main, master ]

jobs:
  test-build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Test installation script
      run: |
        echo "ğŸ§ª ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ í…ŒìŠ¤íŠ¸ ì¤‘..."
        
        # ìŠ¤í¬ë¦½íŠ¸ ê¶Œí•œ í™•ì¸
        if [ -f "one_click_install.sh" ]; then
          chmod +x one_click_install.sh
          echo "âœ… one_click_install.sh ë°œê²¬ë¨"
        fi
        
        if [ -f "enhanced_install.sh" ]; then
          chmod +x enhanced_install.sh  
          echo "âœ… enhanced_install.sh ë°œê²¬ë¨"
        fi
        
        # Python íŒŒì¼ í™•ì¸
        if [ -f "plant_monitoring_system.py" ]; then
          python3 -m py_compile plant_monitoring_system.py
          echo "âœ… plant_monitoring_system.py ì»´íŒŒì¼ ì„±ê³µ"
        fi
        
        if [ -f "automated_monitoring.py" ]; then
          python3 -m py_compile automated_monitoring.py
          echo "âœ… automated_monitoring.py ì»´íŒŒì¼ ì„±ê³µ"
        fi
    
    - name: Create test release package
      run: |
        echo "ğŸ“¦ í…ŒìŠ¤íŠ¸ ë¦´ë¦¬ì¦ˆ íŒ¨í‚¤ì§€ ìƒì„± ì¤‘..."
        
        mkdir -p plant-analysis-sdk-test
        
        # í•„ìˆ˜ íŒŒì¼ë“¤ ë³µì‚¬
        cp *.py plant-analysis-sdk-test/ 2>/dev/null || echo "Python íŒŒì¼ ì—†ìŒ"
        cp *.sh plant-analysis-sdk-test/ 2>/dev/null || echo "ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ì—†ìŒ"
        cp *.md plant-analysis-sdk-test/ 2>/dev/null || echo "Markdown íŒŒì¼ ì—†ìŒ"
        
        # í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
        cat > plant-analysis-sdk-test/test_run.sh << 'EOF'
        #!/bin/bash
        echo "ğŸ§ª Plant Analysis SDK í…ŒìŠ¤íŠ¸ ì‹¤í–‰"
        echo "================================="
        
        # Python ë²„ì „ í™•ì¸
        python3 --version
        
        # í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (í…ŒìŠ¤íŠ¸ìš©)
        pip install numpy matplotlib pandas || echo "íŒ¨í‚¤ì§€ ì„¤ì¹˜ ê±´ë„ˆëœ€"
        
        # ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í…ŒìŠ¤íŠ¸ (ì‹¤ì œë¡œëŠ” ì‹¤í–‰í•˜ì§€ ì•ŠìŒ)
        echo "âœ… ëª¨ë“  íŒŒì¼ì´ ì •ìƒì ìœ¼ë¡œ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!"
        ls -la
        EOF
        
        chmod +x plant-analysis-sdk-test/test_run.sh
        
        # ì••ì¶• ìƒì„±
        tar -czf plant-analysis-sdk-test.tar.gz plant-analysis-sdk-test/
        
        echo "âœ… í…ŒìŠ¤íŠ¸ íŒ¨í‚¤ì§€ ìƒì„± ì™„ë£Œ!"
        ls -la plant-analysis-sdk-test.tar.gz
    
    - name: Upload test artifacts
      uses: actions/upload-artifact@v3
      with:
        name: plant-analysis-sdk-test
        path: plant-analysis-sdk-test.tar.gz
    
    - name: Test summary
      run: |
        echo ""
        echo "ğŸ‰ í…ŒìŠ¤íŠ¸ ë¹Œë“œ ì™„ë£Œ!"
        echo "===================="
        echo ""
        echo "âœ… ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ ê²€ì¦ ì™„ë£Œ"
        echo "âœ… Python íŒŒì¼ ì»´íŒŒì¼ ì„±ê³µ"  
        echo "âœ… í…ŒìŠ¤íŠ¸ íŒ¨í‚¤ì§€ ìƒì„± ì™„ë£Œ"
        echo ""
        echo "ë‹¤ìŒ ë‹¨ê³„:"
        echo "1. Artifacts íƒ­ì—ì„œ í…ŒìŠ¤íŠ¸ íŒ¨í‚¤ì§€ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥"
        echo "2. ì‹¤ì œ ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ì„œ í…ŒìŠ¤íŠ¸ ê¶Œì¥"
        echo "3. ë¬¸ì œì—†ìœ¼ë©´ ì •ì‹ ë¦´ë¦¬ì¦ˆ íƒœê·¸ ìƒì„±"
        echo ""